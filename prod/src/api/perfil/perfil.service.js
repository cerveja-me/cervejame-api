'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.inserePerfil=inserePerfil;exports.consultaPerfilPorEmail=consultaPerfilPorEmail;var _bcryptNodejs=require('bcrypt-nodejs');var _bcryptNodejs2=_interopRequireDefault(_bcryptNodejs);var _httpStatus=require('http-status');var _httpStatus2=_interopRequireDefault(_httpStatus);var _db=require('../../db/db');var _db2=_interopRequireDefault(_db);var _perfil=require('./perfil.queries');var _pgPromise=require('pg-promise');var _errorHandler=require('../../handlers/errorHandler');var _errorHandler2=_interopRequireDefault(_errorHandler);var _camelize=require('camelize');var _camelize2=_interopRequireDefault(_camelize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}async function inserePerfil(perfil){perfil.senha=_bcryptNodejs2.default.hashSync(perfil.senha);const insertPerfil=new _pgPromise.PreparedStatement('insere-perfil',_perfil.INSERT_PERFIL);insertPerfil.values=[perfil.email,perfil.senha,perfil.ativo];try{const perfilCriado=await _db2.default.one(insertPerfil);return(0,_camelize2.default)(perfilCriado)}catch(error){switch(error.code){case'23505':throw new _errorHandler2.default('J\xE1 existe um perfil com o e-mail informado',_httpStatus2.default.BAD_REQUEST,true,error.code);}throw new _errorHandler2.default(`Erro ao tentar cadastrar o perfil. Detalhe(s): ${error.detail}`,_httpStatus2.default.BAD_REQUEST,true,error.code)}}async function consultaPerfilPorEmail(email){const selectPerfilPorEmail=new _pgPromise.PreparedStatement('select-perfil-por-email',_perfil.SELECT_PERFIL_POR_EMAIL);selectPerfilPorEmail.values=[email];try{const perfilSelecionado=await _db2.default.one(selectPerfilPorEmail);return(0,_camelize2.default)(perfilSelecionado)}catch(error){throw new _errorHandler2.default(`Erro ao consultar perfil por email. Detalhe(s): ${error.detail}`,_httpStatus2.default.NOT_FOUND,true,error.code)}}