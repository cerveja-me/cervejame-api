'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.decodeToken=decodeToken;exports.jwtMiddleware=jwtMiddleware;var _dotenv=require('dotenv');var _dotenv2=_interopRequireDefault(_dotenv);var _jsonwebtoken=require('jsonwebtoken');var jwt=_interopRequireWildcard(_jsonwebtoken);var _apiErrorMessage=require('../enums/apiErrorMessage.enum');function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}// import { errorConstant } from '../errorHandler/error.enum'
if(process.env.NODE_ENV==='development'){_dotenv2.default.config()}const secret=process.env.JWT_SECRET;async function validateToken(token){return new Promise((resolve,reject)=>{jwt.verify(token,secret,(err,decoded)=>{if(err){console.log(err);reject(new Error('fa\xE7a login novamente'))}resolve(true)})})}function decodeToken(token){return jwt.decode(token)}function jwtMiddleware(req,res,next){if(req.headers&&req.headers.authorization){const token=req.headers.authorization.split(' ')[1];validateToken(token).then(valid=>{valid?console.log('valido'):console.log('invalido');req.decoded=jwt.decode(token);next()}).catch(error=>{next(error);// console.log(error)
// res.status(401).json({code: apiErrorMessageConstant.EXPIRED_OR_INVALID_TOKEN.code, message: apiErrorMessageConstant.EXPIRED_OR_INVALID_TOKEN.message})
})}else{res.status(401).json(_apiErrorMessage.apiErrorMessageConstant.NO_TOKEN_SUPPLIED)}}